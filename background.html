<script>

  if (localStorage["latest"]!="1"){
  chrome.tabs.create({url:'http://scrolltotopbutton.tumblr.com/latest-version'});
  localStorage["latest"]="1";
  }

// Creates options defaults in case user hasn't set them yet.
  if (!localStorage["scroll_speed"]) {
    localStorage["scroll_speed"] = 1000;
  }
  if (!localStorage["distance_length"]) {
    localStorage["distance_length"] = 400;
  }
  if (!localStorage["size"]) {
    localStorage["size"] = "50px";
  }
  if (!localStorage["arrow"]) {
    localStorage["arrow"] = "arrow_blue";
  }
  if (!localStorage["scroll"]) {
    localStorage["scroll"] = "jswing";
  }
  if (!localStorage["location"]) {
    localStorage["location"] = "TR";
  }
  if (!localStorage["stbb"]) {
    localStorage["stbb"] = "off";
  }
  if (localStorage["distance_length"]==450) {
    localStorage["distance_length"] = 400;
  }
  if (localStorage["distance_length"]==350) {
    localStorage["distance_length"] = 400;
  }

// Message passer to give [LocalStorage] settings to content_script.js which is not allowed access to [LocalStorage].
chrome.extension.onRequest.addListener(
  function(request, sender, sendResponse) {
    if (request.greeting == "settings")
      sendResponse({speed: localStorage["scroll_speed"], distance: localStorage["distance_length"], size: localStorage["size"], arrow: localStorage["arrow"], scroll: localStorage["scroll"], location: localStorage["location"], stbb: localStorage["stbb"]});
    else
      sendResponse({}); // snub them.
  });

</script>

<script> 
     var _gaq = _gaq || [];
     _gaq.push(['_setAccount', 'UA-17657222-1']);
     _gaq.push(['_trackPageview']);

     (function() {
       var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = 'https://ssl.google-analytics.com/ga.js';
       (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
     })();
 </script>
